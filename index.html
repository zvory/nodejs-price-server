<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
        Price Visualization
    </title>
    <link rel="stylesheet" type="text/css" href="entireframework.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="container">
        <p><a href="http://github.com/zvory/price-visualization">GitHub source </a></p>
        <p><span style="color: green">Green</span> line is current price.</p>

        <div>
            <p>Symbol: TLO, Current Price: <span id = "TLOSpan"></span></p>
            <canvas class="chart"  id="TLO" width="800" height="100"></canvas> </div>
        <div><p>Symbol: STC, Current Price: <span id = "STCSpan"></span></p>
            <canvas class="chart"  id="STC" width="800" height="100"></canvas> </div>
        <div><p>Symbol: MC, Current Price: <span id = "MCSpan"></span></p>
             <canvas class="chart"  id="MC" width="800" height="100"></canvas> </div>
        <div><p>Symbol: RTZ, Current Price: <span id = "RTZSpan"></span></p>
            <canvas class="chart"  id="RTZ" width="800" height="100"></canvas> </div>
    </div>

    <script src="https://cdn.socket.io/socket.io-1.4.3.js"></script>
    <script src="smoothie.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"> </script> 

    <script>
var symbols = ['TLO', 'STC', 'MC', 'RTZ'];

var socket = io.connect('csclub.uwaterloo.ca:9091');

socket.on('connect', function () {
    socket.on('price', function (msg) {
        writeGraphs(msg);
    });
});


function myYRangeFunction (range) {
    var min = range.min - 5;
    var max = range.max + 5;
    return {min: min, max: max};
}

this.charts = {};

function Chart (symbol) {
    this.symbol = symbol;
    this.chart = new SmoothieChart(
            {yRangeFunction: myYRangeFunction,
                millisPerPixel:100,
                grid: 
                {strokeStyle: 'rgb(125, 0, 0)',
                    fillStyle: 'rgb(60, 0, 0)',
                    lineWidth: 1,
                    millisPerLine: 250,
                    verticalSections: 6 }});
    this.stream = this.chart.streamTo(document.getElementById(symbol), 1000);
    this.series = new TimeSeries();
    this.chart.addTimeSeries(this.series, { strokeStyle: 'rgb(0, 255, 0)', fillStyle: 'rgba(0, 255, 0, 0.4)', lineWidth: 3 });
}

window.onload = function () {
    symbols.forEach(function (symbol) {
        charts[symbol] = new Chart (symbol);
    });
};


function writeGraphs (msg) {
    charts[msg.symbol].series.append(new Date().getTime(), msg.price);
}
    </script>
</body>
</html>
